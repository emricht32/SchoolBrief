
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/static/styles.css">
  <script defer src="/static/nav.js"></script>
    <title>{{ title or "SchoolBrief" }}</title>
  </head>
  <body>
    <script>
      // Apply stored theme ASAP to avoid FOUC
      (function(){
        try {
          var t = localStorage.getItem('theme');
          if (t === 'dark') document.documentElement.classList.add('dark');
          if (t === 'light') document.documentElement.classList.add('light');
        } catch(e) {}
      })();
    </script>
    <nav>
      <div class="container nav-flex">
        <a href="/" class="nav-brand">SchoolBrief</a>
        <button class="nav-toggle" aria-label="Open navigation menu" onclick="toggleNavMenu()">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </button>
        <div class="nav-links" id="nav-links">
          {% if user %}
            <a href="/app">Dashboard</a>
            <a href="/settings">Settings</a>
            <a href="/billing">Billing</a>
            <a href="/auth/logout">Logout</a>
          {% else %}
            <a href="/auth/google/start">Sign in with Google</a>
          {% endif %}
          <button id="theme-toggle" type="button" style="background:none;border:1px solid var(--color-card-border);color:var(--color-nav-text);padding:6px 10px;border-radius:6px;cursor:pointer;font-size:13px;">üåì</button>
        </div>
      </div>
    </nav>
    <div class="container">
      {% if flash %}<div class="flash">{{ flash }}</div>{% endif %}
      {% block content %}{% endblock %}
    </div>
  </body>
  <script>
    (function(){
      const btn = document.getElementById('theme-toggle');
      if (!btn) return;
      function apply(mode){
        document.documentElement.classList.remove('dark','light');
        if(mode) document.documentElement.classList.add(mode);
        try { localStorage.setItem('theme', mode); } catch(e) {}
        btn.textContent = mode === 'dark' ? '‚òÄÔ∏è' : 'üåì';
        btn.setAttribute('aria-label', mode === 'dark' ? 'Switch to light mode' : 'Switch to dark mode');
      }
      btn.addEventListener('click', function(){
        const currentDark = document.documentElement.classList.contains('dark');
        apply(currentDark ? 'light' : 'dark');
      });
      // If nothing stored, prefer system (leave classes as-is so media query works)
      const stored = localStorage.getItem('theme');
      if (stored === 'dark' || stored === 'light') apply(stored);
    })();
  </script>
</html>
